# 缓存设计

主策略：
（Endpoint中）
Write Behind Pattern（异步缓存写入）✔️
（或者目前严格来说是缓存优先的异步写入）

## 缓存刷新机制（写缓存）

- 缓存刷新策略
  - 全量刷新
    - Directus Hook触发
      - 应用启动预热 (`init: 'app.after'`)
      - 服务器启动 (`action: 'server.start'`)
      - 定时任务 (`schedule`)
    - Directus Endpoint触发
      - API端点手动刷新
    - 自定义事件触发
      - Redis连接恢复 (`redis.on('connect')`)★
      - 数据库连接恢复 (自定义监控)
      - 外部系统事件
  - 增量刷新
    - Directus Hook触发
      - 数据库变化 (`action: '*.items.*'`)
    - Directus Endpoint触发
      - 客户端请求 (答题提交、信息更新等)
    - 自定义事件触发
      - 缓存过期 (Redis TTL events)★
      - 业务事件 (考试开始/结束等)
      - 系统状态变化 (负载、错误率等)

### 1. 全量刷新（Full Refresh）
特点： 重建整个缓存数据集
触发方式：
定时任务（如每30分钟）
应用启动初始化
手动触发的完整重建

### 2. 增量刷新（Incremental Refresh）
特点：仅更新缓存中变化的数据
触发方式：
Directus Hook触发
Directus Endpoint触发
自定义事件触发

